<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="ZCM.Pages.FileSharingPage"
    BackgroundColor="#1E1E1E">

    <Grid ColumnDefinitions="320,*">

        <!-- ===================== -->
        <!-- LEFT: peers + local entry -->
        <!-- ===================== -->
        <Grid Grid.Column="0"
              RowDefinitions="Auto,Auto,*"
              Padding="16"
              BackgroundColor="#151515">

            <Label Text="File Sharing"
                   FontSize="22"
                   FontAttributes="Bold"
                   TextColor="White" />

            <!-- Local sharing -->
            <Frame Grid.Row="1"
                   Margin="0,16"
                   Padding="16"
                   CornerRadius="16"
                   BackgroundColor="#1F1F1F"
                   HasShadow="False">

                <VerticalStackLayout Spacing="10">

                    <Label Text="Local shared files"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="White"/>

                    <Label Text="Manage which files you expose to other peers"
                           FontSize="12"
                           TextColor="#AAAAAA"/>

                    <Button Text="Manage shared files"
                            Clicked="OnMySharedFilesClicked"
                            BackgroundColor="#27AE60"
                            TextColor="White"
                            CornerRadius="10"
                            Padding="12,8"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Peer list -->
            <CollectionView Grid.Row="2"
                            ItemsSource="{Binding Peers}"
                            SelectionMode="Single"
                            SelectionChanged="OnPeerSelectionChanged">

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical"
                                       ItemSpacing="12" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="12"
                               CornerRadius="14"
                               BackgroundColor="#1F1F1F"
                               HasShadow="False">

                            <Label Text="{Binding HostName}"
                                   FontAttributes="Bold"
                                   TextColor="White"/>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </Grid>

        <!-- ===================== -->
        <!-- RIGHT: remote files -->
        <!-- ===================== -->
        <Grid Grid.Column="1"
              RowDefinitions="Auto,Auto,*"
              Padding="20">

            <Label Text="Shared files"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="White"/>

            <!-- Column Header -->
            <Grid Grid.Row="1"
                  Margin="20,16,0,6"
                  ColumnDefinitions="700,50,70,60,120"
                  ColumnSpacing="16">

                <Label Text="File name"
                       FontAttributes="Bold"
                       TextColor="#AAAAAA"
                       VerticalOptions="Center"/>

                <Label Grid.Column="1"
                       Text="Date"
                       FontAttributes="Bold"
                       TextColor="#AAAAAA"
                       HorizontalTextAlignment="Center"
                       VerticalOptions="Center"/>

                <Label Grid.Column="2"
                       Text="Type"
                       FontAttributes="Bold"
                       TextColor="#AAAAAA"
                       HorizontalTextAlignment="Center"
                       VerticalOptions="Center"/>

                <Label Grid.Column="3"
                       Text="Size"
                       FontAttributes="Bold"
                       TextColor="#AAAAAA"
                       HorizontalTextAlignment="Center"
                       VerticalOptions="Center"/>

                <Label Grid.Column="4"
                       Text=""
                       VerticalOptions="Center"/>
            </Grid>

            <!-- Files List -->
            <CollectionView Grid.Row="2"
                            ItemsSource="{Binding Files}"
                            SelectionMode="None">

                <!-- THIS is the important part -->
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical"
                                       ItemSpacing="14" />
                </CollectionView.ItemsLayout>

                <CollectionView.EmptyView>
                    <Label Text="Select a peer to view shared files"
                           TextColor="#666666"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>

                        <Frame Padding="14"
                               CornerRadius="14"
                               BackgroundColor="#1F1F1F"
                               HasShadow="False">

                            <Grid ColumnDefinitions="3*,Auto,Auto,Auto,Auto"
                                  ColumnSpacing="20"
                                  VerticalOptions="Center">

                                <!-- File Name -->
                                <Label Text="{Binding Name}"
                                       TextColor="White"
                                       LineBreakMode="TailTruncation"/>

                                <!-- Date -->
                                <Label Grid.Column="1"
                                       Text="{Binding SharedSinceText}"
                                       TextColor="#CCCCCC"
                                       HorizontalOptions="Center"/>

                                <!-- Type -->
                                <Label Grid.Column="2"
                                       Text="{Binding Type}"
                                       TextColor="#CCCCCC"
                                       HorizontalOptions="Center"/>

                                <!-- Size -->
                                <Label Grid.Column="3"
                                       Text="{Binding SizeText}"
                                       TextColor="#CCCCCC"
                                       HorizontalOptions="Center"/>

                                <!-- Download -->
                                <Button Grid.Column="4"
                                        Text="Download"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DownloadCommand}"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="#6B5DD3"
                                        TextColor="White"
                                        CornerRadius="10"
                                        Padding="16,6"/>
                            </Grid>

                        </Frame>

                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>

        </Grid>

    </Grid>

</ContentPage>
